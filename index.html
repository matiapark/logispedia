<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <title>물류용어 백과사전</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    .content-wrapper {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    #searchBox {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      box-sizing: border-box;
    }
    #suggestions {
      text-align: left;
    }
    .suggestion {
      padding: 8px;
      border: 1px solid #ccc;
      border-top: none;
      cursor: pointer;
    }
    .suggestion:hover {
      background-color: #eef;
    }
    #questionText,
    #answerText,
    #source {
      margin-top: 20px;
      font-size: 16px;
      text-align: left;
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <div class="content-wrapper">
    <h2>물류용어 백과사전</h2>
    <input autocomplete="off" id="searchBox" placeholder="물류 무역 관련 용어를 입력하세요..." type="text"/>
    <div id="suggestions"></div>
    <div id="questionText"></div>
    <div id="answerText"></div>
    <div id="source"></div>
  </div>

  <footer style="background:#f2f2f2; padding:10px 0; font-size:14px;">
    <div>(주)마이아바타</div>
    <div>대표: 박현국</div>
    <div>사업자등록번호: 781-86-02208</div>
  </footer>

  <script>
    async function handleSearch(term) {
      document.getElementById("questionText").innerText = "질문: " + term;

      try {
        const res = await fetch("https://ljmxrdnq97.execute-api.ap-northeast-2.amazonaws.com/prod/search?q=" + encodeURIComponent(term));
        const result = await res.json();
        const answer = result.answer || result.답변 || "";
        const source = result.source || result.출처 || "";

        document.getElementById("answerText").innerText = answer;

        if (answer.toLowerCase().includes("데이터가 없는 질문입니다")) {
          document.getElementById("source").innerText = "";
          document.getElementById("source").style.display = "none";
        } else {
          document.getElementById("source").innerText = source ? "출처: " + source : "";
          document.getElementById("source").style.display = source ? "block" : "none";
        }
      } catch (err) {
        console.error("검색 오류:", err);
      }
    }

    document.getElementById("searchBox").addEventListener("keydown", function (event) {
      if (event.key === "Enter") {
        const term = this.value.trim();
        if (term) handleSearch(term);
      }
    });

    document.getElementById("searchBox").addEventListener("input", async function () {
      const input = this.value.trim();
      const suggestionsBox = document.getElementById("suggestions");
      suggestionsBox.innerHTML = "";

      if (!input) return;

      try {
        const res = await fetch("https://ljmxrdnq97.execute-api.ap-northeast-2.amazonaws.com/prod/listTerms?q=" + encodeURIComponent(input));
        const terms = await res.json();

        // ✅ 중복 제거
        const uniqueTerms = [...new Set(terms)];
        const filtered = uniqueTerms.filter(t => t.toLowerCase().startsWith(input.toLowerCase())).slice(0, 10);

        filtered.forEach(term => {
          const div = document.createElement("div");
          div.className = "suggestion";
          div.innerText = term;
          div.onclick = () => {
            document.getElementById("searchBox").value = term;
            suggestionsBox.innerHTML = "";
            handleSearch(term);  // ✅ 클릭 시 즉시 검색 실행
          };
          suggestionsBox.appendChild(div);
        });
      } catch (err) {
        console.error("자동완성 오류:", err);
      }
    });
  </script>
</body>
</html>
